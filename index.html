<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WeatherWise - Modern Weather App</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background-image: linear-gradient(
          135deg,
          #000000 0%,
          #292827fe 50%,
          #292827fe 100%
        );
        color: white;
        overflow: hidden;
        height: 100vh;
      }

      .background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url(https://images.unsplash.com/photo-1624393297083-aeb947367927?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTl8fHN1bnNldCUyMGNsb3Vkc3xlbnwwfHwwfHx8MA==)
          center/cover;
        filter: brightness(0.7);
        z-index: -1;
      }

      .container {
        display: flex;
        height: 100vh;
        padding: 20px;
        gap: 20px;
      }

      .sidebar {
        width: 300px;
        background: rgba(0, 20, 40, 0.3);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 30px;
        display: flex;
        flex-direction: column;
        gap: 30px;
      }

      .logo {
        font-size: 18px;
        font-weight: 600;
        opacity: 0.9;
      }

      .status-card {
        background: rgba(0, 30, 60, 0.4);
        border-radius: 15px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.5s ease;
      }

      .status-card.dangerous {
        background: rgba(60, 0, 0, 0.4);
        border-color: rgba(255, 100, 100, 0.3);
      }

      .status-card.moderate {
        background: rgba(60, 30, 0, 0.4);
        border-color: rgba(255, 150, 0, 0.3);
      }

      .status-card.safe {
        background: rgba(0, 60, 0, 0.4);
        border-color: rgba(100, 255, 100, 0.3);
      }

      .temperature-chart {
        height: 60px;
        background: linear-gradient(45deg, #00d4ff, #0099cc);
        border-radius: 10px;
        position: relative;
        overflow: hidden;
        transition: all 0.5s ease;
      }

      .temperature-chart.dangerous {
        background: linear-gradient(45deg, #ff4444, #cc0000);
      }

      .temperature-chart.moderate {
        background: linear-gradient(45deg, #ffaa44, #ff6600);
      }

      .temperature-chart.safe {
        background: linear-gradient(45deg, #44ff44, #00cc00);
      }

      .chart-line {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: white;
        border-radius: 3px;
        transform: translateY(-20px);
        width: 30%;
        transition: all 0.5s ease;
      }

      .chart-line.dangerous {
        width: 80%;
        background: #ffaaaa;
      }

      .chart-line.moderate {
        width: 55%;
        background: #ffddaa;
      }

      .chart-line.safe {
        width: 25%;
        background: #aaffaa;
      }

      .status-text {
        color: inherit;
        transition: all 0.5s ease;
      }

      .status-text.dangerous {
        color: #ff6666;
      }

      .status-text.moderate {
        color: #ffaa66;
      }

      .status-text.safe {
        color: #66ff66;
      }

      .temp-value {
        font-size: 24px;
        font-weight: 600;
        margin-top: 10px;
      }

      .location-card {
        text-align: center;
        padding: 20px;
      }

      .location-icon {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        margin: 0 auto 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        background: radial-gradient(
          circle at 30% 30%,
          #8b4513,
          #654321,
          #2f1b14
        );
        border: 2px solid rgba(255, 255, 255, 0.2);
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .location-icon:hover {
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
      }

      .globe-continents {
        position: absolute;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 120"><g fill="%23654321" opacity="0.7"><path d="M30 40c10-5 20-3 25 5 8 15-5 25-15 20-8-4-12-15-10-25z"/><path d="M60 30c15 0 25 10 20 25-3 10-15 15-25 10-12-6-8-20 5-25z"/><path d="M40 70c12 2 20 12 15 22-4 8-18 5-25-5-6-12 2-18 10-17z"/><path d="M75 65c8 8 5 20-8 22-10 1-15-12-10-20 4-6 12-8 18-2z"/></g></svg>')
          center/cover;
      }

      .location-pin {
        position: absolute;
        width: 8px;
        height: 8px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 2;
      }

      .location-pin:hover {
        transform: scale(1.5);
        background: #00ff88;
        box-shadow: 0 0 15px rgba(0, 255, 136, 0.9);
      }

      .location-pin::after {
        content: attr(data-city);
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 10px;
        white-space: nowrap;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
      }

      .location-pin:hover::after {
        opacity: 1;
      }

      .pin-1 {
        top: 35%;
        left: 25%;
      }
      .pin-2 {
        top: 45%;
        left: 45%;
      }
      .pin-3 {
        top: 35%;
        left: 65%;
      }
      .pin-4 {
        top: 55%;
        left: 35%;
      }
      .pin-5 {
        top: 50%;
        left: 70%;
      }

      .globe-shine {
        position: absolute;
        top: 10%;
        left: 20%;
        width: 30%;
        height: 30%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.3) 0%,
          transparent 70%
        );
        border-radius: 50%;
      }

      .city-selector {
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 20, 40, 0.9);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        padding: 10px;
        min-width: 150px;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 10;
      }

      .city-selector.show {
        opacity: 1;
        visibility: visible;
        top: 110%;
      }

      .city-option {
        padding: 8px 12px;
        cursor: pointer;
        border-radius: 6px;
        transition: all 0.3s ease;
        font-size: 12px;
      }

      .city-option:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #00ff88;
      }

      .location-name {
        font-size: 16px;
        font-weight: 500;
        opacity: 0.9;
      }

      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .location-info {
        display: flex;
        align-items: center;
        gap: 8px;
        opacity: 0.8;
      }

      .actions {
        display: flex;
        gap: 10px;
      }

      .action-btn {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .action-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .download-btn {
        background: rgba(0, 120, 255, 0.2);
        border: 1px solid rgba(0, 120, 255, 0.3);
        padding: 8px 16px;
        border-radius: 10px;
        color: #00a8ff;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
      }

      .current-weather {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 40px 0;
      }

      .temperature-display {
        display: flex;
        align-items: baseline;
        gap: 20px;
      }

      .main-temp {
        font-size: 120px;
        font-weight: 300;
        line-height: 1;
      }

      .temp-range {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .temp-high,
      .temp-low {
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
      }

      .temp-high {
        background: rgba(255, 255, 255, 0.2);
      }

      .temp-low {
        background: rgba(255, 255, 255, 0.1);
      }

      .weather-description {
        text-align: center;
      }

      .description-main {
        font-size: 48px;
        font-weight: 300;
        margin-bottom: 10px;
        opacity: 0.9;
      }

      .description-sub {
        font-size: 24px;
        opacity: 0.7;
      }

      .description-text {
        font-size: 14px;
        opacity: 0.6;
        max-width: 300px;
        margin-top: 20px;
      }

      .additional-info {
        display: flex;
        gap: 20px;
        margin: 20px 0;
      }

      .info-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 15px;
        flex: 1;
        text-align: center;
      }

      .info-value {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 5px;
      }

      .info-label {
        font-size: 12px;
        opacity: 0.7;
      }

      .forecast {
        display: flex;
        justify-content: space-between;
        margin-top: 40px;
      }

      .forecast-day {
        text-align: center;
        padding: 20px;
        border-radius: 15px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        flex: 1;
        margin: 0 5px;
        transition: all 0.3s ease;
      }

      .forecast-day:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-5px);
      }

      .forecast-day.active {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
      }

      .day-name {
        font-size: 14px;
        opacity: 0.7;
        margin-bottom: 15px;
      }

      .day-temp {
        font-size: 24px;
        font-weight: 500;
      }

      .weather-curve-container {
        position: relative;
        margin-top: 40px;
        height: 100px;
        width: 100%;
      }

      .weather-curve {
        position: absolute;
        bottom: 20px;
        left: 0;
        right: 0;
        height: 3px;
        background: transparent;
      }

      .curve-svg {
        width: 100%;
        height: 100px;
        position: absolute;
        bottom: 0;
      }

      .curve-path {
        fill: none;
        stroke: rgba(255, 255, 255, 0.6);
        stroke-width: 2;
        filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
      }

      .weather-star {
        position: absolute;
        width: 16px;
        height: 16px;
        background: white;
        clip-path: polygon(
          50% 0%,
          61% 35%,
          98% 35%,
          68% 57%,
          79% 91%,
          50% 70%,
          21% 91%,
          32% 57%,
          2% 35%,
          39% 35%
        );
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.8),
          0 0 40px rgba(255, 255, 255, 0.4);
        transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        animation: starGlow 2s infinite alternate;
        left: 55%;
        bottom: 80px;
        transform: translateX(-50%);
      }

      @keyframes starGlow {
        0% {
          box-shadow: 0 0 20px rgba(255, 255, 255, 0.8),
            0 0 40px rgba(255, 255, 255, 0.4);
          transform: translateX(-50%) scale(1);
        }
        100% {
          box-shadow: 0 0 30px rgba(255, 255, 255, 1),
            0 0 60px rgba(255, 255, 255, 0.6);
          transform: translateX(-50%) scale(1.1);
        }
      }

      .star-positions {
        /* Positions for each day of the week */
      }

      .star-day-0 {
        left: 10%;
        bottom: 45px;
      }
      .star-day-1 {
        left: 25%;
        bottom: 55px;
      }
      .star-day-2 {
        left: 40%;
        bottom: 60px;
      }
      .star-day-3 {
        left: 55%;
        bottom: 80px;
      }
      .star-day-4 {
        left: 70%;
        bottom: 65px;
      }
      .star-day-5 {
        left: 85%;
        bottom: 50px;
      }

      .curve-indicators {
        position: absolute;
        bottom: 15px;
        width: 100%;
        display: flex;
        justify-content: space-between;
        padding: 0 8%;
      }

      .curve-dot {
        width: 6px;
        height: 6px;
        background: rgba(255, 255, 255, 0.4);
        border-radius: 50%;
        transition: all 0.3s ease;
      }

      .curve-dot.active {
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
        transform: scale(1.5);
      }

      @media (max-width: 768px) {
        .container {
          flex-direction: column;
          padding: 10px;
        }

        .sidebar {
          width: 100%;
          height: auto;
        }

        .main-temp {
          font-size: 80px;
        }

        .forecast {
          overflow-x: auto;
          padding-bottom: 10px;
        }

        .forecast-day {
          min-width: 100px;
        }
      }
    </style>
  </head>
  <body>
    <div class="status-header">
      <span class="status-title" id="weather-status"></span>

      <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path d="M9 11l3 3 8-8" />
      </svg>
    </div>
    <div class="background"></div>

    <div class="container">
      <aside class="sidebar">
        <div class="logo">WeatherWise</div>

        <div class="status-card" id="statusCard">
          <div class="status-header">
            <span class="status-title">Status</span>
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M9 11l3 3 8-8" />
            </svg>
          </div>
          <div class="status-title status-text" id="statusText">Dangerous</div>
          <div class="temperature-chart" id="tempChart">
            <div class="chart-line" id="chartLine"></div>
          </div>
          <div class="temp-value">23.84¬∞</div>
          <div style="font-size: 12px; opacity: 0.6; margin-top: 10px">
            See Microdetails >
          </div>
        </div>

        <div class="location-card">
          <div class="status-title" style="margin-bottom: 15px">
            Selekto Zonen
          </div>
          <div
            style="
              display: flex;
              align-items: center;
              gap: 10px;
              margin-bottom: 20px;
            "
          >
            <span style="color: #ff6b35">‚òÖ</span>
            <span style="font-size: 18px">5.0</span>
          </div>
          <div class="location-icon" id="globeIcon">
            <div class="globe-continents"></div>
            <div class="globe-shine"></div>
            <!-- Location pins -->
            <div class="location-pin pin-1" data-city="Fier"></div>
            <div class="location-pin pin-2" data-city="Berat"></div>
            <div class="location-pin pin-3" data-city="Tirana"></div>
            <div class="location-pin pin-4" data-city="Pogradec"></div>
            <div class="city-selector" id="citySelector">
              <!-- City options will be injected here dynamically -->
            </div>
          </div>
          <div class="location-name" id="currentLocation">
            Brooklyn, New York, USA
          </div>
        </div>
      </aside>

      <main class="main-content">
        <header class="header">
          <div class="location-info">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
              <circle cx="12" cy="10" r="3" />
            </svg>
            <span>Brooklyn, New York, USA</span>
            <span id="currentDate" style="opacity: 0.5"
              >( Loading date... )</span
            >
          </div>
          <div class="actions">
            <div class="action-btn">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="11" cy="11" r="8" />
                <path d="M21 21l-4.35-4.35" />
              </svg>
            </div>
            <a href="#" class="download-btn">Shkarko App</a>
          </div>
        </header>

        <div class="current-weather">
          <div class="temperature-display">
            <div class="main-temp" id="temperature"></div>
            <div class="temp-range">
              <div class="temp-high" id="temp-high"></div>
              <div class="temp-low" id="temp-low"></div>
            </div>
          </div>
          <div class="weather-description">
            <div class="description-main" id="weather-desc"></div>
            <div class="description-sub" id="weather-detail"></div>
            <div class="description-text" id="weather-status"></div>
          </div>
        </div>

        <div id="city-weather-cards" class="additional-info">
          <!-- Dynamic cards for Italy and Kosovo will be inserted here -->
        </div>
        <script>
          const apiKey = "911625a1518f69fa778918f736d163f6";

          const cities = {
            Tirana: { lat: 41.3275, lon: 19.8189 },
            Fier: { lat: 40.7244, lon: 19.5562 },
            Berat: { lat: 40.7053, lon: 19.952 },
            Pogradec: { lat: 40.911, lon: 20.6612 },
          };

          const dayNames = [
            "E diele",
            "E hene",
            "E marte",
            "E merkure",
            "E enjte",
            "E premte",
            "E shtune",
          ];

          async function fetchAndDisplayForecast(cityName) {
            const { lat, lon } = cities[cityName];
            const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=sq`;

            try {
              const res = await fetch(url);
              const data = await res.json();
              if (data.cod !== "200") throw new Error(data.message);

              // Group forecast data by date
              const dailyTemps = {};
              data.list.forEach((item) => {
                const date = item.dt_txt.split(" ")[0];
                if (!dailyTemps[date]) dailyTemps[date] = [];
                dailyTemps[date].push(item.main.temp);
              });

              // Calculate average temp per day
              const dailyAvgTemps = Object.entries(dailyTemps).map(
                ([date, temps]) => {
                  const avg = temps.reduce((a, b) => a + b, 0) / temps.length;
                  return { date, avgTemp: avg.toFixed(1) };
                }
              );

              // Select the forecast container
              const forecastDiv = document.querySelector("#forecast");
              if (!forecastDiv) return;

              // Clear previous temps
              const tempDivs = forecastDiv.querySelectorAll(".day-temp");
              tempDivs.forEach((div) => (div.textContent = ""));

              // Fill temps (up to 6 days as per your HTML)
              for (let i = 0; i < tempDivs.length; i++) {
                if (dailyAvgTemps[i]) {
                  tempDivs[i].textContent = dailyAvgTemps[i].avgTemp + "¬∞C";
                } else {
                  tempDivs[i].textContent = "-";
                }
              }
            } catch (error) {
              console.error("Forecast fetch error:", error);
            }
          }

          // Show Tirana forecast on page load
          window.addEventListener("load", () => {
            fetchAndDisplayForecast("Tirana");
          });

          // Attach city pin clicks to update forecast
          document.querySelectorAll(".location-pin").forEach((pin) => {
            pin.addEventListener("click", () => {
              const city = pin.dataset.city;
              if (city && cities[city]) {
                fetchAndDisplayForecast(city);
              }
            });
          });

          const weekdays = [
            "E diele",
            "E hene",
            "E marte",
            "E merkure",
            "E enjte",
            "E premte",
            "E shtune",
          ];

          document.querySelectorAll(".location-pin").forEach((pin) => {
            pin.addEventListener("click", () => {
              const city = pin.getAttribute("data-city");
              getForecast(city); // vet√´m p√´r forecast
              updateWeatherAndLocation(city); // p√´r t√´ marr√´ current weather
            });
          });

          async function getForecast(cityName) {
            const city = cities[cityName];
            const url = `https://api.openweathermap.org/data/3.0/onecall?lat=${city.lat}&lon=${city.lon}&exclude=current,minutely,hourly,alerts&appid=${apiKey}&units=metric&lang=sq`;

            try {
              const response = await fetch(url);
              const data = await response.json();

              const forecastDays = document.querySelectorAll(".forecast-day");
              data.daily.slice(0, 6).forEach((dayData, index) => {
                const tempDay = Math.round(dayData.temp.day);
                const forecastEl =
                  forecastDays[index].querySelector(".day-temp");
                forecastEl.textContent = `${tempDay}¬∞C`;
              });
            } catch (error) {
              console.error("Gabim gjat√´ marrjes s√´ t√´ dh√´nave:", error);
            }
          }

          async function updateForecast(city) {
            const { lat, lon } = cityCoords[city];

            const response = await fetch(
              `https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&exclude=minutely,hourly,alerts&units=metric&appid=${apiKey}`
            );
            const data = await response.json();

            const forecastDays = document.querySelectorAll(".forecast-day");

            data.daily.slice(0, 6).forEach((day, index) => {
              const temp = Math.round(day.temp.day);
              const desc = day.weather[0].description;

              if (forecastDays[index]) {
                forecastDays[index].querySelector(".day-name").textContent =
                  weekdays[index];
                forecastDays[index].querySelector(
                  ".day-temp"
                ).textContent = `${temp}¬∞C ‚Ä¢ ${desc}`;
              }
            });
          }

          // Event listeners p√´r pin-at
          document.querySelectorAll(".location-pin").forEach((pin) => {
            pin.addEventListener("click", () => {
              const city = pin.getAttribute("data-city");
              updateForecast(city);
            });
          });

          // Default load (Tirana)
          updateForecast("Tirana");
        </script>

        <div class="forecast" id="forecast">
          <div class="forecast-day">
            <div class="day-name">E diele</div>
            <div class="day-temp">--¬∞C</div>
          </div>
          <div class="forecast-day">
            <div class="day-name">E hene</div>
            <div class="day-temp">--¬∞C</div>
          </div>
          <div class="forecast-day">
            <div class="day-name">E marte</div>
            <div class="day-temp">--¬∞C</div>
          </div>
          <div class="forecast-day">
            <div class="day-name">E merkure</div>
            <div class="day-temp">--¬∞C</div>
          </div>
          <div class="forecast-day">
            <div class="day-name">E enjte</div>
            <div class="day-temp">--¬∞C</div>
          </div>
          <div class="forecast-day">
            <div class="day-name">E premte</div>
            <div class="day-temp">--¬∞C</div>
          </div>
        </div>

        <div class="weather-curve-container">
          <svg class="curve-svg" viewBox="0 0 800 100">
            <path
              class="curve-path"
              d="M 80 55 Q 200 35 320 40 T 560 20 Q 640 35 720 50"
            />
          </svg>
          <div class="weather-star" id="weatherStar"></div>
          <div class="curve-indicators">
            <div class="curve-dot"></div>
            <div class="curve-dot"></div>
            <div class="curve-dot"></div>
            <div class="curve-dot active"></div>
            <div class="curve-dot"></div>
            <div class="curve-dot"></div>
          </div>
        </div>
      </main>
    </div>
    <span id="currentLocation" class="location-name">Loading location...</span>
    <span id="currentDate">( Loading date... )</span>

    <div id="weather-status"></div>
    <div id="weather-desc"></div>
    <div id="temperature"></div>
    <div id="low-temp"></div>
    <div id="high-temp"></div>
    <div id="mid-temp"></div>
    <div id="night-temp"></div>
    <div id="weather-detail"></div>
    <div id="feels-like-1"></div>
    <script>
      // Fetch weather for a city and update ALL main weather UI fields
      async function updateWeatherAndLocation(city = "Tirana") {
        try {
          const response = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=sq`
          );
          const data = await response.json();

          if (data.cod !== 200) throw new Error(data.message || "Gabim n√´ API");

          // Update city and country
          document.getElementById(
            "currentLocation"
          ).textContent = `${data.name}, ${data.sys.country}`;
          const locationInfo = document.querySelector(".location-info span");
          if (locationInfo)
            locationInfo.textContent = `${data.name}, ${data.sys.country}`;

          // Update date
          const now = new Date();
          const options = { weekday: "long", month: "long", day: "numeric" };
          const formattedDate = now.toLocaleDateString("en-US", options);
          document.getElementById(
            "currentDate"
          ).textContent = `( ${formattedDate} )`;

          // Update weather status and description
          document.getElementById("weather-status").textContent =
            data.weather[0].main;
          document.getElementById("weather-desc").textContent =
            data.weather[0].description.charAt(0).toUpperCase() +
            data.weather[0].description.slice(1);

          // Update temperature
          document.getElementById(
            "temperature"
          ).textContent = `${data.main.temp.toFixed(1)}¬∞C`;

          // Min/Max
          document.getElementById(
            "temp-high"
          ).textContent = `Max: ${data.main.temp_max.toFixed(1)}¬∞C`;
          document.getElementById(
            "temp-low"
          ).textContent = `Min: ${data.main.temp_min.toFixed(1)}¬∞C`;

          // Mesatare (average)
          if (document.getElementById("mid-temp")) {
            const midTemp = (
              (data.main.temp_min + data.main.temp_max) /
              2
            ).toFixed(1);
            document.getElementById(
              "mid-temp"
            ).textContent = `Mesatare: ${midTemp}¬∞C`;
          }

          // Naten (use min as approximation)
          if (document.getElementById("night-temp")) {
            document.getElementById(
              "night-temp"
            ).textContent = `Nat√´n: ${data.main.temp_min.toFixed(1)}¬∞C`;
          }

          // Weather detail (last update)
          document.getElementById(
            "weather-detail"
          ).textContent = `P√´rdit√´suar m√´: ${new Date(
            data.dt * 1000
          ).toLocaleTimeString("sq-AL")}`;

          // Feels like
          if (document.getElementById("feels-like-1"))
            document.getElementById(
              "feels-like-1"
            ).textContent = `Feels like: ${data.main.feels_like.toFixed(1)}¬∞C`;
        } catch (error) {
          document.getElementById("currentLocation").textContent =
            "Nuk mund t√´ ngarkohet vendodhja";
          document.getElementById("weather-status").textContent =
            "Nuk mund t√´ ngarkohet moti";
        }
        updateForecastForCity(city);
      }

      // Function to update the 7-day forecast for a city
      async function updateForecastForCity(city) {
        const shqipDitet = [
          "E diele",
          "E hene",
          "E marte",
          "E merkure",
          "E enjte",
          "E premte",
          "E shtune",
        ];
        try {
          // Get coordinates for the city
          const geoRes = await fetch(
            `https://api.openweathermap.org/geo/1.0/direct?q=${city}&limit=1&appid=${apiKey}`
          );
          const geoData = await geoRes.json();
          if (!geoData[0]) throw new Error("No coordinates found for city");
          const lat = geoData[0].lat;
          const lon = geoData[0].lon;

          // Fetch 7-day forecast
          const forecastRes = await fetch(
            `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=current,minutely,hourly,alerts&units=metric&appid=${apiKey}&lang=sq`
          );
          const forecastData = await forecastRes.json();

          // Update forecast UI
          const forecastDiv = document.getElementById("forecast");
          for (let i = 0; i < 6; i++) {
            const dayData = forecastData.daily[i];
            const date = new Date(dayData.dt * 1000);
            const dayName = shqipDitet[date.getDay()];
            const dayTemp = Math.round(dayData.temp.max);

            const dayDiv = forecastDiv.children[i];
            if (dayDiv) {
              dayDiv.querySelector(".day-name").textContent = dayName;
              dayDiv.querySelector(".day-temp").textContent = `${dayTemp}¬∞C`;
            }
          }
        } catch (error) {
          console.error("Gabim n√´ marrjen e forecast:", error);
        }
      }

      // On page load, show default city (Tirana)
      document.addEventListener("DOMContentLoaded", () => {
        updateWeatherAndLocation("Tirana");
      });

      // Pin click handler
      document.querySelectorAll(".location-pin").forEach((pin) => {
        pin.addEventListener("click", function (e) {
          e.stopPropagation();
          const city = this.dataset.city;
          updateWeatherAndLocation(city);
          // Optionally close city selector if open
          const selector = document.getElementById("citySelector");
          if (selector) selector.classList.remove("show");
        });
      });
    </script>

    <script>
      // Add some interactive functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Weather conditions for each day
        const weatherConditions = [
          { condition: "moderate", temp: 28, weather: "Sunny" }, // Sunday
          { condition: "safe", temp: 26, weather: "Clear" }, // Monday
          { condition: "moderate", temp: 27, weather: "Cloudy" }, // Tuesday
          { condition: "dangerous", temp: 23, weather: "Stormy" }, // Wednesday
          { condition: "moderate", temp: 30, weather: "Partly Cloudy" }, // Thursday
          { condition: "safe", temp: 25, weather: "Clear" }, // Friday
        ];

        // Add CSS for globe spinning and colors
        const globeStyle = document.createElement("style");
        globeStyle.textContent = `
    /* Updated globe continent colors */
    .globe-continents {
        position: absolute;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 120"><g><path fill="%234CAF50" d="M30 40c10-5 20-3 25 5 8 15-5 25-15 20-8-4-12-15-10-25z"/><path fill="%234CAF50" d="M60 30c15 0 25 10 20 25-3 10-15 15-25 10-12-6-8-20 5-25z"/><path fill="%234CAF50" d="M40 70c12 2 20 12 15 22-4 8-18 5-25-5-6-12 2-18 10-17z"/><path fill="%234CAF50" d="M75 65c8 8 5 20-8 22-10 1-15-12-10-20 4-6 12-8 18-2z"/></g></svg>') center/cover;
        z-index: 2;
    }
    
    .globe-oceans {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: radial-gradient(circle at 30% 30%, #2196F3, #1976D2, #0D47A1);
        z-index: 1;
    }

    @keyframes globeSpin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .globe-continents.spinning {
        animation: globeSpin 8s linear infinite;
    }
`;
        document.head.appendChild(globeStyle);
        async function fetchWeather(city) {
          const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`; // Metric units (Celsius)
          try {
            const response = await fetch(url);
            const data = await response.json();
            if (data.cod === 200) {
              return {
                city: data.name,
                country: data.sys.country,
                temp: Math.round(data.main.temp), // Temperature in Celsius
              };
            } else {
              console.error("Error fetching weather data", data.message);
              return null;
            }
          } catch (error) {
            console.error("Error:", error);
            return null;
          }
        }

        // Globe and city selector functionality
        const globeIcon = document.getElementById("globeIcon");
        const citySelector = document.getElementById("citySelector");
        const currentLocation = document.getElementById("currentLocation");
        const locationInfo = document.querySelector(".location-info span");
        const mainTemp = document.querySelector(".main-temp");

        // Add ocean element to globe
        const globeOceans = document.createElement("div");
        globeOceans.className = "globe-oceans";
        globeIcon.insertBefore(globeOceans, globeIcon.firstChild);

        // Toggle city selector and start/stop globe spinning
        globeIcon.addEventListener("click", function (e) {
          e.stopPropagation();
          citySelector.classList.toggle("show");

          const continents = globeIcon.querySelector(".globe-continents");

          if (citySelector.classList.contains("show")) {
            // Start spinning when selector is open
            continents.classList.add("spinning");
          } else {
            // Stop spinning when selector is closed
            continents.classList.remove("spinning");
          }
        });

        // Close city selector when clicking outside
        document.addEventListener("click", function (e) {
          if (!globeIcon.contains(e.target)) {
            citySelector.classList.remove("show");

            // Stop globe spinning when selector is closed
            const continents = globeIcon.querySelector(".globe-continents");
            continents.classList.remove("spinning");
          }
        });

        // Handle city selection
        const cityOptions = document.querySelectorAll(".city-option");
        cityOptions.forEach((option) => {
          option.addEventListener("click", function () {
            const city = this.dataset.city;
            const country = this.dataset.country;
            const temp = this.dataset.temp;

            // Update location displays
            currentLocation.textContent = `${city}, ${country}`;
            locationInfo.textContent = `${city}, ${country}`;
            mainTemp.textContent = temp;

            // Close selector
            citySelector.classList.remove("show");

            // Stop globe spinning
            const continents = globeIcon.querySelector(".globe-continents");
            continents.classList.remove("spinning");

            // Add selection effect
            this.style.background = "rgba(200, 255, 136, 0.2)";
            setTimeout(() => {
              this.style.background = "";
            }, 300);
          });
        });

        // Pin click functionality
        const locationPins = document.querySelectorAll(".location-pin");
        locationPins.forEach((pin) => {
          pin.addEventListener("click", function (e) {
            e.stopPropagation();
            const city = this.dataset.city;

            // Find corresponding city option and click it
            const correspondingOption = Array.from(cityOptions).find(
              (option) => option.dataset.city === city
            );
            if (correspondingOption) {
              correspondingOption.click();
            }
          });
        });

        // Make forecast days clickable
        const forecastDays = document.querySelectorAll(".forecast-day");
        const curveDots = document.querySelectorAll(".curve-dot");
        const weatherStar = document.getElementById("weatherStar");
        const statusCard = document.getElementById("statusCard");
        const statusText = document.getElementById("statusText");
        const tempChart = document.getElementById("tempChart");
        const chartLine = document.getElementById("chartLine");

        // Function to update status based on weather condition
        function updateStatus(condition) {
          // Reset all classes
          statusCard.className = "status-card";
          statusText.className = "status-title status-text";
          tempChart.className = "temperature-chart";
          chartLine.className = "chart-line";

          // Add new classes
          statusCard.classList.add(condition);
          statusText.classList.add(condition);
          tempChart.classList.add(condition);
          chartLine.classList.add(condition);

          // Update status text
          const statusTexts = {
            dangerous: "Dangerous",
            moderate: "Moderate",
            safe: "Safe",
          };
          statusText.textContent = statusTexts[condition];
        }

        // Set initial position (Wednesday - dangerous)
        weatherStar.classList.add("star-day-3");
        updateStatus("dangerous");

        forecastDays.forEach((day, index) => {
          day.addEventListener("click", function () {
            // Remove active states
            forecastDays.forEach((d) => d.classList.remove("active"));
            curveDots.forEach((d) => d.classList.remove("active"));

            // Add active state
            this.classList.add("active");
            if (curveDots[index]) {
              curveDots[index].classList.add("active");
            }

            // Move star to new position
            weatherStar.className = "weather-star";
            weatherStar.classList.add(`star-day-${index}`);

            // Update status based on weather condition
            const condition = weatherConditions[index];
            updateStatus(condition.condition);
          });
        });

        // Animate temperature chart
        const chartLineElement = document.querySelector(".chart-line");
        if (chartLineElement) {
          setTimeout(() => {
            chartLineElement.style.animation = "pulse 2s infinite alternate";
          }, 1000);
        }

        // Add hover effects to action buttons
        const actionBtns = document.querySelectorAll(".action-btn");
        actionBtns.forEach((btn) => {
          btn.addEventListener("mouseenter", function () {
            this.style.transform = "scale(1.1)";
          });

          btn.addEventListener("mouseleave", function () {
            this.style.transform = "scale(1)";
          });
        });
      });

      // Add CSS animation
      const style = document.createElement("style");
      style.textContent = `
@keyframes pulse {
    0% { opacity: 0.5; transform: translateY(-20px) scaleX(0.8); }
    100% { opacity: 1; transform: translateY(-15px) scaleX(1.2); }
}

/* Define star positions */
.star-day-0 { left: 10%; bottom: 45px; }
.star-day-1 { left: 25%; bottom: 55px; }
.star-day-2 { left: 40%; bottom: 60px; }
.star-day-3 { left: 55%; bottom: 80px; }
.star-day-4 { left: 70%; bottom: 65px; }
.star-day-5 { left: 85%; bottom: 50px; }
`;
      document.head.appendChild(style);
      async function updateForecast() {
        try {
          const response = await fetch(
            `https://api.openweathermap.org/data/2.5/onecall?lat=${latitude}&lon=${longitude}&exclude=current,minutely,hourly,alerts&appid=${apiKey}&units=metric&lang=sq`
          );
          const data = await response.json();

          if (!data.daily)
            throw new Error("Nuk u gjet√´n t√´ dh√´nat e parashikimit");
          const cities = ["Fier", "Berat", "Tirana", "Pogradec"];
          const days = [
            "E diele",
            "E hene",
            "E marte",
            "E merkure",
            "E enjte",
            "E premte",
            "E shtune",
          ];
          const forecastDiv = document.getElementById("forecast");
          const dailyForecasts = data.daily;

          for (let i = 0; i < dailyForecasts.length && i < 6; i++) {
            const dayData = dailyForecasts[i];
            const dayName = days[new Date(dayData.dt * 1000).getDay()];
            const dayTemp = dayData.temp.day.toFixed(1);

            const dayDiv = forecastDiv.children[i];
            dayDiv.querySelector(".day-name").textContent = dayName;
            dayDiv.querySelector(".day-temp").textContent = `${dayTemp}¬∞C`;
          }
        } catch (error) {
          console.error("Gabim n√´ marrjen e forecast:", error);
        }
      }
      document.addEventListener("DOMContentLoaded", () => {
        updateWeatherAndLocation();
        updateForecast();
      });
    </script>
    <script>
      const dynamicCities = ["Rome,IT", "Pristina,XK"]; // Italy (Rome), Kosovo (Pristina)

      async function loadCityWeatherCards() {
        const container = document.getElementById("city-weather-cards");
        container.innerHTML = ""; // Clear existing

        for (const city of dynamicCities) {
          try {
            const res = await fetch(
              `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=sq`
            );
            const data = await res.json();
            if (data.cod !== 200) continue;

            const emoji = data.weather[0].main.includes("Cloud")
              ? "‚òÅÔ∏è"
              : data.weather[0].main.includes("Rain")
              ? "üåßÔ∏è"
              : data.weather[0].main.includes("Clear")
              ? "‚òÄÔ∏è"
              : "üå°Ô∏è";

            const card = document.createElement("div");
            card.className = "info-card";
            card.innerHTML = `
          <div style="margin-bottom: 10px">${emoji}</div>
          <div class="info-value">${Math.round(data.main.temp)}¬∞</div>
          <div class="info-label">${data.name}, ${data.sys.country}</div>
          <div style="font-size: 10px; opacity: 0.5">Ndihet si ${Math.round(
            data.main.feels_like
          )}¬∞</div>
        `;
            container.appendChild(card);
          } catch (error) {
            console.error("Error loading city card:", error);
          }
        }

        // Add 'Recent Searches' block
        const extra = document.createElement("div");
        extra.style.marginLeft = "auto";
        extra.innerHTML = `
      <div style="font-size: 12px; opacity: 0.6">Kerkimet e fundit</div>
      <div style="color: #00a8ff; font-size: 14px; margin-top: 5px">
        Shiko te gjitha>
      </div>
    `;
        container.appendChild(extra);
      }

      document.addEventListener("DOMContentLoaded", loadCityWeatherCards);
    </script>

    <script>
      async function fetchLazyWeather(city) {
        const res = await fetch(`/api/lazy?city=${city}`);
        const weather = await res.text();
        document.getElementById("weatherDisplay").innerText =
          "Moti ne " + city + ": " + weather;
      }
    </script>
    <script>
      // Funksion p√´r p√´rkthim dit√´sh nga anglisht n√´ shqip
      const shqipDitet = {
        Sunday: "E diele",
        Monday: "E hene",
        Tuesday: "E marte",
        Wednesday: "E merkure",
        Thursday: "E enjte",
        Friday: "E premte",
        Saturday: "E shtune",
      };

      async function merrForecast() {
        // Koordinatat e Tiran√´s
        const lat = 41.3275;
        const lon = 19.8189;

        // API key (vendos tuajin ketu)
        const apiKey = "911625a1518f69fa778918f736d163f6";

        // URL me parametrat p√´r forecast 7 ditor dhe njesin√´ ne Celcius
        const url = `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=current,minutely,hourly,alerts&units=metric&appid=${apiKey}`;

        try {
          const response = await fetch(url);
          const data = await response.json();

          // Merr 6 dit√´t e para nga 'daily' array (p√´rfshin edhe dit√´n e sotme)
          for (let i = 0; i < 6; i++) {
            const dayData = data.daily[i];
            const date = new Date(dayData.dt * 1000); // konverton nga unix timestamp n√´ Date

            // Emri i dites ne shqip
            const dayName =
              shqipDitet[date.toLocaleDateString("en-US", { weekday: "long" })];

            // Temperatura maksimale e dites
            const dayTemp = Math.round(dayData.temp.max);

            // Vendos emrin dhe temperaturen ne HTML
            document.getElementById(`day-name-${i}`).textContent = dayName;
            document.getElementById(`day-temp-${i}`).textContent =
              dayTemp + "¬∞";
          }
        } catch (error) {
          console.error("Gabim ne marrjen e te dhenave te motit:", error);
        }
      }

      // List of cities you want weather data for

      // Fetch weather data for a city
      async function fetchWeather(city) {
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`; // Metric units (Celsius)
        try {
          const response = await fetch(url);
          const data = await response.json();
          if (data.cod === 200) {
            return {
              city: data.name,
              country: data.sys.country,
              temp: Math.round(data.main.temp), // Temperature in Celsius
            };
          } else {
            console.error("Error fetching weather data", data.message);
            return null;
          }
        } catch (error) {
          console.error("Error:", error);
          return null;
        }
      }

      async function fetchWeather(city) {
        // Example dummy weather data
        return {
          city: city,
          country: "AL",
          temp: Math.floor(Math.random() * 35), // Random temperature
        };
      }

      // Function to update the city options dynamically
      async function updateCityWeather() {
        const cityWeatherData = await Promise.all(cities.map(fetchWeather));
        const citySelector = document.getElementById("citySelector");

        // Clear any existing city options
        citySelector.innerHTML = "";

        // Add each city option dynamically
        cityWeatherData.forEach((data) => {
          if (data) {
            const cityOption = document.createElement("div");
            cityOption.classList.add("city-option");
            cityOption.dataset.city = data.city;
            cityOption.dataset.country = data.country;
            cityOption.dataset.temp = `${data.temp}¬∞`;
            cityOption.innerHTML = `${data.city}, ${data.country} (${data.temp}¬∞C)`;

            citySelector.appendChild(cityOption);
          }
        });
      }

      // Function to update the location name and temperature on the card
      function updateLocation(city, temp) {
        const locationName = document.getElementById("currentLocation");
        locationName.innerHTML = `${city}, ${temp}¬∞C`;

        // Update the temperature in the status section
        const statusTemperature = document.querySelector(
          ".status-title span:nth-child(2)"
        );
        if (statusTemperature) {
          statusTemperature.innerText = `${temp}¬∞`;
        }
      }

      // Event listener for location pins
      document.querySelectorAll(".location-pin").forEach((pin) => {
        pin.addEventListener("click", async (event) => {
          const cityName = event.target.dataset.city;
          const weatherData = await fetchWeather(cityName);
          if (weatherData) {
            updateLocation(weatherData.city, weatherData.temp);
          }
        });
      });

      // Call the function when the page loads
      window.onload = () => {
        updateCityWeather();
        // If you have a separate function like merrForecast, call it too:
        // merrForecast();
      };
    </script>
  </body>
</html>
